<!DOCTYPE HTML>
<html>
  <head>
    <title>Sign in - StuyBooks</title>
    <link href="../static/bootstrap.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="../static/logo.png">
    <link rel="stylesheet" type="text/css" href="../static/style.css"/>

    <meta name="google-signin-client_id" content="546971034348-fflcn8cq3l3g5a9od0dnorlbgckrquuo.apps.googleusercontent.com">



    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <script src="https://apis.google.com/js/api:client.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

    <script>
      var googleUser = {};
      var startApp = function() {
      gapi.load('auth2', function(){
      // Retrieve the singleton for the GoogleAuth library and set up the client.
      auth2 = gapi.auth2.init({
      client_id: "546971034348-fflcn8cq3l3g5a9od0dnorlbgckrquuo.apps.googleusercontent.com",
      cookiepolicy: 'single_host_origin',
      // Request scopes in addition to 'profile' and 'email'
      //scope: 'profile email'
      });
      attachSignin(document.getElementById('customBtn'));
      });
      };

      function attachSignin(element) {
      console.log(element.id);
      auth2.attachClickHandler(element, {},
      function(googleUser) {
      var profile = googleUser.getBasicProfile();
      console.log('ID: ' + profile.getId());
      console.log('Full Name: ' + profile.getName());
      console.log('Given Name: ' + profile.getGivenName());
      console.log('Family Name: ' + profile.getFamilyName());
      console.log('Image URL: ' + profile.getImageUrl());
      console.log('Email: ' + profile.getEmail());
      console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
      name = profile.getName();
      email = profile.getEmail();
     
      $.ajax({
      type: "GET",
      url:"/",
      data:{"name":name,"email":email},
      success: function(){ window.location.href="/"; },
      });

      }
      )};

    </script>
    <style type="text/css">
      #customBtn {
      display: inline-block;
      background: white;
      color: #444;
      width: 190px;
      border-radius: 5px;
      border: thin solid #888;
      box-shadow: 1px 1px 1px grey;
      white-space: nowrap;
      }
      #customBtn:hover {
      cursor: pointer;
      }
      span.label {
      font-family: serif;
      font-weight: normal;
      }
      
      span.buttonText {
      display: inline-block;
      vertical-align: middle;
      padding-left: 42px;
      padding-right: 42px;
      font-size: 14px;
      font-weight: bold;
      /* Use the Roboto font that is loaded in the <head> */
	font-family: 'Roboto', sans-serif;
	}
    </style>


  </head>

  <body>
    <div class="container-login">
      <div class="login">
	<div>
	  <img class="logo" src="{{ url_for('static', filename='logo.png') }}" height="65"><br><br>
	  <h1>Sign in to StuyBooks</h1>
	</div>
	<br>
	<div class="container-form">
	  <!--<button class="btn btn-default" type="button" id="emailLogin">Log in via Gmail</button><br><br>-->

	  <form name="login" method="POST">
	    <p class="alert alert-danger">{{msg}}</p><br>
	    Email<br><div class="input-group">
              <input name='email' type="text" class="form-control" placeholder="Email" aria-describedby="basic-addon2">
              <span class="input-group-addon" id="basic-addon2">@stuy.edu</span>
	    </div><br>
	    Password<br><input name='pword' type="password" class="form-control input-block"><br>
	    <button class="btn btn-success btn-block" type="submit" id="submit">Submit</button>
	  </form>
	</div>
	<br>
	<div class="gmail">
	  <a href='forgot'>Forgot your password?</a>
	  <p style="font-size: 15px;">Login via Google <a href="login">
	      Gmail</a></p>
	</div>
	<br>
	<!--iv id="my-signin2" onClick="renderButton()"></div>-->
	


	<script>

	  function onSuccess(googleUser) {
	  var profile = googleUser.getBasicProfile();
	  console.log('ID: ' + profile.getId());
	  console.log('Full Name: ' + profile.getName());
	  console.log('Given Name: ' + profile.getGivenName());
	  console.log('Family Name: ' + profile.getFamilyName());
	  console.log('Image URL: ' + profile.getImageUrl());
	  console.log('Email: ' + profile.getEmail());
	  console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
	  name = profile.getName();
	  email = profile.getEmail();
	  if (email.indexOf('@stuy.edu') == -1)
	  console.log('Error: must use stuy.edu email')
	  //TODO redirect to login page with email error
	  //console.log(name);
	  //console.log(email);
	  $.ajax({
	  type: "GET",
	  url:"/",
	  data:{"name":name,"email":email},
	  success: function(){ window.location.href="/"; },

	  });

	  }

	  function onFailure(error) {
	  console.log(error);
	  }

	  function renderButton() {
	  //if ($("#my-signin2").clicked){
	  gapi.signin2.render('my-signin2', {
	  'scope': 'profile email',
	  'width': 240,
	  'height': 50,
	  'longtitle': true,
	  'theme': 'dark',
	  'onsuccess': onSuccess,
	  'onfailure': onFailure
	  });
	  //};
	  }

	</script>




	<!-- In the callback, you would hide the gSignInWrapper element on a
	     successful sign in -->
	<div id="gSignInWrapper">
	  <span class="label">Sign in with:</span>
	  <div id="customBtn" class="customGPlusSignIn">
	    <span class="icon"></span>
	    <span class="buttonText">Google</span>
	  </div>
	</div>
	<div id="name"></div>
	<script>startApp();</script>


	<!--
	    <script type="text/javascript">
	      (function() {
	      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
	      po.src = 'https://apis.google.com/js/client.js?onload=onLoadCallback';
	      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	      })();
	    </script>

	    <script>

	      function login()
	      {
	      var myParams = {
	      'clientid' : "546971034348-fflcn8cq3l3g5a9od0dnorlbgckrquuo.apps.googleusercontent.com", //You need to set client id
	      'cookiepolicy' : 'single_host_origin',
	      'callback' : 'loginCallback', //callback function
	      'approvalprompt':'force',
	      'scope' : 'profile email'
	      };
	      gapi.auth.signIn(myParams);
	      }
	    </script>
	    -->


	<script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>

      </div>
    </div>
  </body>
</html>
